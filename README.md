# EntryExit-Management-System
大阪電気通信大学 情報通信工学部のハッカソン企画で開発した入退室管理システムです．

## システムの使い方
部屋を入退室する際に利用者は学生証をかざすだけで良い．

## システム概要
システムの全体構成図をFig.1に示す．
![システム構成図](https://github.com/xwasoux/image/blob/master/systemFigure.png)

### ローカルサイド
このシステムに必要な機材は以下の3つです．

+ Raspberry pi 4 (Raspberry Pi OS)
+ Pasori
+ USB スピーカー

Raspberry piはローカル側のシステムの中枢を担うコンピュータです．このコンピュータからカードの情報や音声の出力などを制御します．

Pasoriは，SONYから発売されている非接触型 IC カードリーダのことである．本校の学生証はFelica(フェリカ)と呼ばれる非接触型 IC カード技術 方式に対応しているため，この機器を利用することが可能である．

スピーカーは，カードをかざした際のサウンド再生に必要である．


### サーバーサイド

以上が使用機器の説明でした．
　その他にも，GoogleのサーバやAPIを利用して，クラウド上でのログデータの保存や，Slack・メールでの通知なども行っています．
　それでは使い方を見ていきましょう．
　利用方法は簡単です．あなたが入室あるいは退室の際にカードリーダに学生証をかざすだけです．またこの時，スピーカーから音声を流して挨拶もしてくれます．
　続いて，このシステムの仕組みを説明します．全体のシステム構成はこの様になっています．一つづつ見ていきましょう．

　まず，学生証をカードリーダにかざすことでカード内の情報を読み取ります．読み取った情報から学生番号の情報のみを抽出し，変数に格納します．同時に日付・時間も取得し変数に格納します．

　では，取得された情報はどの様に処理されるのでしょうか？仕組みは簡単です．

　まず，学籍番号・日時・時間の他にもう一つ，今の状況，つまり退室したか入室したかを示す変数を用意します．
　次に，学籍番号と今の状況を紐付けるために辞書型を用います．辞書型を用いる理由は，外部ファイルへのアクセス・読み込み・書き出しを減らすことでなるべく処理速度を遅くしない様にしたいと考えたからです．
　そして，辞書の中に当該の学籍番号がないか，if文を用いて検索します．
検索の結果存在しない場合は，学籍番号をkeyに，今の状況を示す“entry”をvalueに格納します．
同時に，先ほど作成した，今の状況を示す変数に辞書のvalueを代入します．これで入室時の処理は完了です．

　そして，次に先ほどの学籍番号の情報が変数に格納された際には，辞書のkeyを検索しvalueが”entry”であれば”exit”に書き換え，変数にもう一度格納します．この様にして入退室の判別を行います．

　こうして得られた情報はすぐさまGoogle spreadsheetに配列として転送されます．ちなみにこの機能を用いるには，Google spreadsheet API を取得する必要があります．

### サーバーサイド
　そして，得られた情報を Google Apps Script を用いることで，Slackやメールでの通知を可能とします．Google Apps Script を利用するための特別な設定は必要ありません．ただし，Slackへの通知には，別途APIを利用する必要があります．Slackでは，こうしたWebhooksを用いた連携を行う必要があります．

これがシステム全体の仕組みです．
